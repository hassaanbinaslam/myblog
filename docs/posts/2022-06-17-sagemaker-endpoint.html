<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2022-06-17">
<meta name="description" content="How to call an ML model endpoint hosted by SageMaker using serverless technology.">

<title>Serverless Inference with SageMaker Serverless Endpoints – Random Thoughts</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../images/favicon.ico" rel="icon">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-84543be43ff612bda7a31c913735130b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-D1ST9BH6HX"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-D1ST9BH6HX', { 'anonymize_ip': true});
</script>


<link rel="stylesheet" href="../styles.css">
<meta property="og:title" content="Serverless Inference with SageMaker Serverless Endpoints – Random Thoughts">
<meta property="og:description" content="How to call an ML model endpoint hosted by SageMaker using serverless technology.">
<meta property="og:image" content="images/2022-06-17-sagemaker-endpoint.jpeg">
<meta property="og:site_name" content="Random Thoughts">
<meta name="twitter:title" content="Serverless Inference with SageMaker Serverless Endpoints – Random Thoughts">
<meta name="twitter:description" content="How to call an ML model endpoint hosted by SageMaker using serverless technology.">
<meta name="twitter:image" content="images/2022-06-17-sagemaker-endpoint.jpeg">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Random Thoughts</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/hassaanbinaslam/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/hassaanbinaslam/"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/hassaanbinaslam"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#about" id="toc-about" class="nav-link active" data-scroll-target="#about">About</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#deploy-sagemaker-serverless-endpoint" id="toc-deploy-sagemaker-serverless-endpoint" class="nav-link" data-scroll-target="#deploy-sagemaker-serverless-endpoint">Deploy SageMaker Serverless Endpoint</a>
  <ul class="collapse">
  <li><a href="#through-sagemaker-console-ui" id="toc-through-sagemaker-console-ui" class="nav-link" data-scroll-target="#through-sagemaker-console-ui">Through SageMaker Console UI</a></li>
  <li><a href="#through-sagemaker-python-sdk" id="toc-through-sagemaker-python-sdk" class="nav-link" data-scroll-target="#through-sagemaker-python-sdk">Through SageMaker Python SDK</a></li>
  </ul></li>
  <li><a href="#deploy-lambda-function-with-function-url" id="toc-deploy-lambda-function-with-function-url" class="nav-link" data-scroll-target="#deploy-lambda-function-with-function-url">Deploy Lambda Function with Function URL</a></li>
  <li><a href="#test-serverless-inference-through-postman" id="toc-test-serverless-inference-through-postman" class="nav-link" data-scroll-target="#test-serverless-inference-through-postman">Test Serverless Inference through Postman</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Serverless Inference with SageMaker Serverless Endpoints</h1>
  <div class="quarto-categories">
    <div class="quarto-category">aws</div>
    <div class="quarto-category">ml</div>
    <div class="quarto-category">sagemaker</div>
  </div>
  </div>

<div>
  <div class="description">
    How to call an ML model endpoint hosted by SageMaker using serverless technology.
  </div>
</div>


<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">June 17, 2022</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p><img src="images/2022-06-17-sagemaker-endpoint.jpeg" class="img-fluid"></p>
<section id="about" class="level1">
<h1>About</h1>
<p>You have trained and deployed a model using Amazon SageMaker. You have an endpoint and now you are wondering “After I deploy an endpoint, where do I go from there?” Your concerns are valid because SageMaker endpoints are not public but are scoped to an individual account. In this post, we will discuss how to make them public using AWS serverless technologies: AWS Lambda and Function URL. We will also make our endpoints serverless so our ML inference solution is serverless end-to-end.</p>
</section>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>The following diagram shows how a model is called using AWS serverless architecture. <br><br> <img src="images/2022-06-17-sagemaker-endpoint/serverless-architecture.png" class="img-fluid" alt="serverless-architecture"></p>
<p>Starting from the client, an application calls the AWS Lambda Function URL and passes parameter values. The Lambda function parses the request and passes it to SageMaker model endpoint. This endpoint can be hosted on an EC2 instance or you have the option to make it serverless. Serverless endpoints behave similarly to Lambda functions. Once a request is received by the endpoint it will perform the prediction and return the predicted values to Lambda. The Lambda function then parses the returned values and sends the final response back to the client.</p>
<p>To train a model using Amazon SageMaker you can follow my other post <a href="https://hassaanbinaslam.github.io/myblog/aws/ml/sagemaker/2022/06/08/sagemaker-training-overview.html">Demystifying Amazon SageMaker Training for scikit-learn Lovers</a>. There I have trained SageMaker Linear Learner model on Boston housing dataset.</p>
<p><code>Note that this post assumes that you have already trained a model and is available in SageMaker model repository.</code></p>
</section>
<section id="deploy-sagemaker-serverless-endpoint" class="level1">
<h1>Deploy SageMaker Serverless Endpoint</h1>
<section id="through-sagemaker-console-ui" class="level2">
<h2 class="anchored" data-anchor-id="through-sagemaker-console-ui">Through SageMaker Console UI</h2>
<p>Let’s first deploy our serverless endpoint through SageMaker console UI. In the next section, we will do the same through SageMaker Python SDK.</p>
<p>Visit the SageMaker model repository to find the registered Linear Learner model. You can find the repository on the <strong>SageMaker Inference &gt; Model</strong> page.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/2022-06-17-sagemaker-endpoint/model-repo.png" class="img-fluid figure-img"></p>
<figcaption>model-repo</figcaption>
</figure>
</div>
<p>Note the mode name <code>linear-learner-2022-06-16-09-10-17-207</code> as will need it in later steps.</p>
<p>Click on the <em>model name</em> and then <strong>Create endpoint</strong></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/2022-06-17-sagemaker-endpoint/create-endpoint.png" class="img-fluid figure-img"></p>
<figcaption>create-endpoint</figcaption>
</figure>
</div>
<p>This will take you to <strong>configure endpoint page</strong>. Here do the following configurations. * Set <strong>Endpoint name</strong> to <code>2022-06-17-sagemaker-endpoint-serverless</code>. You may use any other unique string here. * From <strong>Attach endpoint configuration</strong> select <code>create a new endpoint configuration</code> * From <strong>New endpoint configuration &gt; Endpoint configuration</strong> set * <strong>Endpoint configuration name</strong> to <code>config-2022-06-17-sagemaker-endpoint-serverless</code>. You may use any other name here. * <strong>Type of endpoint</strong> to <code>Serverless</code> * From <strong>Production variants</strong> click on <strong>Add Model</strong> and then select the model name we want to deploy. In our case it is <code>linear-learner-2022-06-16-09-10-17-207</code>. Click <strong>Save</strong>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/2022-06-17-sagemaker-endpoint/add-model.png" class="img-fluid figure-img"></p>
<figcaption>add-model</figcaption>
</figure>
</div>
<ul>
<li>Then Edit the <strong>Max Concurrency</strong> and set it to 5.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/2022-06-17-sagemaker-endpoint/max-concurrency.png" class="img-fluid figure-img"></p>
<figcaption>max-concurrency</figcaption>
</figure>
</div>
<ul>
<li>Click <strong>Create endpoint configuration</strong></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/2022-06-17-sagemaker-endpoint/new-endpoint-config.png" class="img-fluid figure-img"></p>
<figcaption>new-endpoint-config</figcaption>
</figure>
</div>
<ul>
<li>Click <strong>Create endpoint</strong></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/2022-06-17-sagemaker-endpoint/endpoint-created.png" class="img-fluid figure-img"></p>
<figcaption>endpoint-created</figcaption>
</figure>
</div>
<p>It will take a minute for the created endpoint to become ready.</p>
<p>While we were configuring the concurrency for our endpoint we have given it a value of 5. This is because at this point there is a limit on concurrency per account across all serverless endpoints. The maximum total concurrency for an account is 20, and if you cross this limit you will get an error as shown below.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/2022-06-17-sagemaker-endpoint/serverless-endpoints-concurrency-error.png" class="img-fluid figure-img"></p>
<figcaption>serverless-endpoints-concurrency-error</figcaption>
</figure>
</div>
</section>
<section id="through-sagemaker-python-sdk" class="level2">
<h2 class="anchored" data-anchor-id="through-sagemaker-python-sdk">Through SageMaker Python SDK</h2>
<p>Let’s create another endpoint but using SageMaker SDK. Deploying a model to a serverless endpoint using SDK involves the following steps: * Get session to SageMaker API * Create a serverless endpoint deployment config * Create a reference to a model container * Deploy the model on a serverless endpoint using serverless configuration</p>
<p>Let’s do it now.</p>
<div id="cell-4" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="co">##</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="co"># get a session to sagemaker api</span></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="im">import</span> sagemaker</span>
<span id="cb1-4"><a href="#cb1-4"></a></span>
<span id="cb1-5"><a href="#cb1-5"></a>session <span class="op">=</span> sagemaker.Session()</span>
<span id="cb1-6"><a href="#cb1-6"></a>role <span class="op">=</span> sagemaker.get_execution_role()</span>
<span id="cb1-7"><a href="#cb1-7"></a></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="bu">print</span>(<span class="ss">f"sagemaker.__version__: </span><span class="sc">{</span>sagemaker<span class="sc">.</span>__version__<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="bu">print</span>(<span class="ss">f"Session: </span><span class="sc">{</span>session<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="bu">print</span>(<span class="ss">f"Role: </span><span class="sc">{</span>role<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>sagemaker.__version__: 2.88.1
Session: &lt;sagemaker.session.Session object at 0x7feb1853fc10&gt;
Role: arn:aws:iam::801598032724:role/service-role/AmazonSageMaker-ExecutionRole-20220516T161743</code></pre>
</div>
</div>
<div id="cell-5" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a><span class="co">##</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="co"># define a serverless endpoint configuration</span></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="im">from</span> sagemaker.serverless <span class="im">import</span> ServerlessInferenceConfig</span>
<span id="cb3-4"><a href="#cb3-4"></a></span>
<span id="cb3-5"><a href="#cb3-5"></a>serverless_config <span class="op">=</span> ServerlessInferenceConfig(</span>
<span id="cb3-6"><a href="#cb3-6"></a>    memory_size_in_mb<span class="op">=</span><span class="dv">1024</span>, max_concurrency<span class="op">=</span><span class="dv">5</span></span>
<span id="cb3-7"><a href="#cb3-7"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that here we are only defining the endpoint configuration. It will be created when we will deploy the model. Also, note that we have not passed any configuration name. It will default to the endpoint name. To read more about the serverless inference configuration read the documentation <a href="https://sagemaker.readthedocs.io/en/stable/api/inference/serverless.html?highlight=serverless_inference_config#module-sagemaker.serverless.serverless_inference_config">ServerlessInferenceConfig</a></p>
<p>I could not find a way to give a name to endpoint configuration from SageMaker SDK. Let me know in the comments if there is a way to do it.</p>
<div id="cell-7" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1"></a><span class="co">##</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="co"># create a SageMaker model. </span></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="co"># In our case model is already registered so it will only create a reference to it</span></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="im">from</span> sagemaker.model <span class="im">import</span> Model</span>
<span id="cb4-5"><a href="#cb4-5"></a></span>
<span id="cb4-6"><a href="#cb4-6"></a>ll_model <span class="op">=</span> Model(</span>
<span id="cb4-7"><a href="#cb4-7"></a>    image_uri <span class="op">=</span> <span class="st">'382416733822.dkr.ecr.us-east-1.amazonaws.com/linear-learner'</span>, <span class="co"># find it from the SageMaker mode repository</span></span>
<span id="cb4-8"><a href="#cb4-8"></a>    name <span class="op">=</span> <span class="st">'linear-learner-2022-06-16-09-10-17-207'</span>,</span>
<span id="cb4-9"><a href="#cb4-9"></a>    role<span class="op">=</span>role</span>
<span id="cb4-10"><a href="#cb4-10"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>While creating a SageMaker model you need to provide its container URI, name, and role. The role gives necessary permissions to SageMaker to pull the image container from the ECR repository. To read more about the Model read the docs <a href="https://sagemaker.readthedocs.io/en/stable/api/inference/model.html?highlight=EndpointConfig#sagemaker.model.Model">sagemaker.model.Model</a></p>
<div id="cell-9" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a><span class="co">##</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="co"># define the endpoint name</span></span>
<span id="cb5-3"><a href="#cb5-3"></a>endpoint_name <span class="op">=</span> <span class="st">'2022-06-17-sagemaker-endpoint-serverless-sdk'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-10" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1"></a><span class="co">##</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="co"># deploy the model to serverless endpoint</span></span>
<span id="cb6-3"><a href="#cb6-3"></a>ll_model.deploy(</span>
<span id="cb6-4"><a href="#cb6-4"></a>    endpoint_name<span class="op">=</span>endpoint_name,</span>
<span id="cb6-5"><a href="#cb6-5"></a>    serverless_inference_config<span class="op">=</span>serverless_config,</span>
<span id="cb6-6"><a href="#cb6-6"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Using already existing model: linear-learner-2022-06-16-09-10-17-207</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>-----!</code></pre>
</div>
</div>
<p>It will take a minute or so for the serverless endpoint to get provisioned. Once it is ready (InService) you will find it on the <strong>SageMaker Inference &gt; Endpoints</strong> page.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/2022-06-17-sagemaker-endpoint/endpoint-created-sdk.png" class="img-fluid figure-img"></p>
<figcaption>endpoint-created-sdk</figcaption>
</figure>
</div>
<p><code>model.deploy()</code> command will also create the endpoint configuration with same name as endpoint, and it can be found on <strong>SageMaker Inference &gt; Endpoint configurations</strong> page</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/2022-06-17-sagemaker-endpoint/new-endpoint-config-sdk.png" class="img-fluid figure-img"></p>
<figcaption>new-endpoint-config-sdk</figcaption>
</figure>
</div>
</section>
</section>
<section id="deploy-lambda-function-with-function-url" class="level1">
<h1>Deploy Lambda Function with Function URL</h1>
<p>Our model’s serverless endpoint is ready, and in this section we will make it public using AWS Lambda and Function URL. Let’s create our Lambda Function.</p>
<p>From AWS Lambda console, click <strong>Create Function</strong> and make the following configurations.</p>
<p>Under <strong>Basic Information</strong> * Function name = ‘linear-learner-boston-demo’ * Runtime = ‘Python 3.9’ * Execution Role = ‘Create a new role with basic Lambda permissions’</p>
<p>Under <strong>Advanced Settings</strong> * Check ‘Enable function URL’ * ‘Auth type’ to None. This is for demo purposes.</p>
<p>Click <strong>Create Function</strong></p>
<p>Once the function is created click on it to open its page.</p>
<p>Under <code>Function Overview</code> on the bottom right there is a Function URL that we can call to access it publically.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/2022-06-17-sagemaker-endpoint/lambda-function-created.png" class="img-fluid figure-img"></p>
<figcaption>lambda-function-created</figcaption>
</figure>
</div>
<p>For our function to call SageMaker endpoint we first need to give it some extra permissions. For this click on the Lambda <strong>Configurations &gt; Permissions &gt; Role name</strong>. This will open the IAM page for the Role, and the Policies under that role. Select the Policy attached to this Role and Click Edit.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/2022-06-17-sagemaker-endpoint/iam-policy.png" class="img-fluid figure-img"></p>
<figcaption>iam-policy</figcaption>
</figure>
</div>
<p>On the next page add the following permissions to your policy.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb9-1"><a href="#cb9-1"></a><span class="fu">{</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>    <span class="dt">"Sid"</span><span class="fu">:</span> <span class="st">"VisualEditor2"</span><span class="fu">,</span></span>
<span id="cb9-3"><a href="#cb9-3"></a>    <span class="dt">"Effect"</span><span class="fu">:</span> <span class="st">"Allow"</span><span class="fu">,</span></span>
<span id="cb9-4"><a href="#cb9-4"></a>    <span class="dt">"Action"</span><span class="fu">:</span> <span class="st">"sagemaker:InvokeEndpoint"</span><span class="fu">,</span></span>
<span id="cb9-5"><a href="#cb9-5"></a>    <span class="dt">"Resource"</span><span class="fu">:</span> <span class="st">"*"</span></span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>After adding those line your final policy will look similar to this.</p>
<pre><code>{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": "logs:CreateLogGroup",
            "Resource": "arn:aws:logs:us-east-1:801598032724:*"
        },
        {
            "Effect": "Allow",
            "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents"
            ],
            "Resource": [
                "arn:aws:logs:us-east-1:801598032724:log-group:/aws/lambda/linear-learner-boston-demo:*"
            ]
        },
        {
            "Sid": "VisualEditor2",
            "Effect": "Allow",
            "Action": "sagemaker:InvokeEndpoint",
            "Resource": "*"
        }
    ]
}</code></pre>
<p>Review policy and save your changes.</p>
<p>Now go back to your Lambda console and use the following code.</p>
<div id="cell-13" class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1"></a><span class="im">import</span> json</span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="im">import</span> boto3</span>
<span id="cb11-3"><a href="#cb11-3"></a></span>
<span id="cb11-4"><a href="#cb11-4"></a>runtime<span class="op">=</span> boto3.client(<span class="st">'runtime.sagemaker'</span>)</span>
<span id="cb11-5"><a href="#cb11-5"></a></span>
<span id="cb11-6"><a href="#cb11-6"></a>endpoint_name <span class="op">=</span> <span class="st">'2022-06-17-sagemaker-endpoint-serverless-sdk'</span></span>
<span id="cb11-7"><a href="#cb11-7"></a>    </span>
<span id="cb11-8"><a href="#cb11-8"></a><span class="kw">def</span> lambda_handler(event, context):</span>
<span id="cb11-9"><a href="#cb11-9"></a>    <span class="bu">print</span>(<span class="st">"Received event: "</span> <span class="op">+</span> json.dumps(event, indent<span class="op">=</span><span class="dv">2</span>))</span>
<span id="cb11-10"><a href="#cb11-10"></a>    data <span class="op">=</span> json.loads(json.dumps(event))</span>
<span id="cb11-11"><a href="#cb11-11"></a>    payload <span class="op">=</span> data[<span class="st">'body'</span>]</span>
<span id="cb11-12"><a href="#cb11-12"></a>    </span>
<span id="cb11-13"><a href="#cb11-13"></a>    <span class="co">#payload = '0.00632,18.00,2.310,0,0.5380,6.5750,65.20,4.0900,1,296.0,15.30,4.98'</span></span>
<span id="cb11-14"><a href="#cb11-14"></a>    </span>
<span id="cb11-15"><a href="#cb11-15"></a>    response <span class="op">=</span> runtime.invoke_endpoint(EndpointName<span class="op">=</span>endpoint_name,</span>
<span id="cb11-16"><a href="#cb11-16"></a>                                       ContentType<span class="op">=</span><span class="st">'text/csv'</span>,</span>
<span id="cb11-17"><a href="#cb11-17"></a>                                       Body<span class="op">=</span>payload)    </span>
<span id="cb11-18"><a href="#cb11-18"></a>    <span class="bu">print</span>(response)</span>
<span id="cb11-19"><a href="#cb11-19"></a>    </span>
<span id="cb11-20"><a href="#cb11-20"></a>    result <span class="op">=</span> json.loads(response[<span class="st">'Body'</span>].read().decode())</span>
<span id="cb11-21"><a href="#cb11-21"></a>    <span class="bu">print</span>(result)</span>
<span id="cb11-22"><a href="#cb11-22"></a>    </span>
<span id="cb11-23"><a href="#cb11-23"></a>    <span class="cf">return</span> {</span>
<span id="cb11-24"><a href="#cb11-24"></a>        <span class="st">'statusCode'</span>: <span class="dv">200</span>,</span>
<span id="cb11-25"><a href="#cb11-25"></a>        <span class="st">'body'</span>: json.dumps(result)</span>
<span id="cb11-26"><a href="#cb11-26"></a>    }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>What we have done here is</p>
<ul>
<li>use boto3 SDK to create a session with SageMaker API. We did not use SageMaker SDK here because it is not available in the Lambda environment as of now. You may read more about it here <a href="https://github.com/aws/sagemaker-python-sdk/issues/1200">sagemaker-python-sdk in AWS Lambda</a></li>
<li>then we have defined the endpoint name that we want to call from this function</li>
<li>in the lambda handler we have parsed the request to get the payload</li>
<li>next we have invoked the serverless endpoint with the payload</li>
<li>then we parsed the response to get the predictions</li>
<li>finally we have returned the prediction</li>
</ul>
<p>Note that in the endpoint we have used <code>2022-06-17-sagemaker-endpoint-serverless-sdk</code> which we have created through SageMaker SDK. You may also use <code>2022-06-17-sagemaker-endpoint-serverless</code> which we created from UI as both point to the same model.</p>
<p>Let’s deploy our function code, and create a test event. Give it a name and use the following event body</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode numberSource json number-lines code-with-copy"><code class="sourceCode json"><span id="cb12-1"><a href="#cb12-1"></a><span class="fu">{</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>  <span class="dt">"body"</span><span class="fu">:</span> <span class="st">"0.00632,18.00,2.310,0,0.5380,6.5750,65.20,4.0900,1,296.0,15.30,4.98"</span></span>
<span id="cb12-3"><a href="#cb12-3"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now test it. The first time I tested it I got a timeout exception. The reason for this is that the default timeout for the Lambda function is 3 seconds. But when the function called serverless endpoint it could not get any response during that time window. This is because of a <strong>cold start</strong> for the serverless endpoint.</p>
<blockquote class="blockquote">
<p>If your endpoint does not receive traffic for a while and then your endpoint suddenly receives new requests, it can take some time for your endpoint to spin up the compute resources to process the requests. This is called a <strong>cold start</strong>. Since serverless endpoints provision compute resources on demand, your endpoint may experience cold starts. A cold start can also occur if your concurrent requests exceed the current concurrent request usage. The cold start time depends on your model size, how long it takes to download your model, and the start-up time of your container.</p>
</blockquote>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/2022-06-17-sagemaker-endpoint/lambda-coldstart-timeout.png" class="img-fluid figure-img"></p>
<figcaption>lambda-coldstart-timeout</figcaption>
</figure>
</div>
<p>On the next test event I got a successful response from the Lambda function as shown below.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/2022-06-17-sagemaker-endpoint/lambda-event-success.png" class="img-fluid figure-img"></p>
<figcaption>lambda-event-success</figcaption>
</figure>
</div>
<p>You can find the logs for your serverless endpoint on AWS CloudWatch under log group <strong>/aws/sagemaker/Endpoints/[endpoint-name]</strong>. In our case it will be <code>/aws/sagemaker/Endpoints/2022-06-17-sagemaker-endpoint-serverless</code>. If you look at the logs you will find that serverless endpoint is doing the following steps:</p>
<ul>
<li>loading request and response encoders</li>
<li>loading the model</li>
<li>starting a gunicorn server</li>
<li>starting a server listener</li>
<li>making prediction</li>
<li>returning results</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/2022-06-17-sagemaker-endpoint/cloudwatch-logs.png" class="img-fluid figure-img"></p>
<figcaption>cloudwatch-logs</figcaption>
</figure>
</div>
</section>
<section id="test-serverless-inference-through-postman" class="level1">
<h1>Test Serverless Inference through Postman</h1>
<p>At this point our inference endpoint is ready to be consumed from external applications. Let’s use Postman for testing. Copy the lambda function URL and paste it in Postman Request UI. For the body use the following text.</p>
<pre><code>0.00632,18.00,2.310,0,0.5380,6.5750,65.20,4.0900,1,296.0,15.30,4.98</code></pre>
<p>Send a POST request and on SUCCESS you will get the predictions as shown below</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/2022-06-17-sagemaker-endpoint/postman-success.png" class="img-fluid figure-img"></p>
<figcaption>postman-success</figcaption>
</figure>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://utteranc.es/client.js" repo="hassaanbinaslam/myblog_utterances" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->




</body></html>